var SJ=function(){var a=function(){function a(){}return a.prototype.extend=function(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a},a.prototype.configure=function(){var a=Array.prototype.slice.call(arguments);return this.extend.apply(null,[this].concat(a))},a}(),b=function(){function b(a){var b={uri:"https://api.schedjoules.com",version:"v1",locale:"en",location:"us"};this.configure(b,a)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.load_data=function(a,b){var c=new XMLHttpRequest;if("withCredentials"in c){var d=this.get_url(a);c.open("GET",d,!0),c.setRequestHeader("Authorization",'Token token="'+this.api_key+'"'),c.onload=function(){c.status>=200&&c.status<400?b(JSON.parse(c.responseText)):console.log("The Schedjoules API returned an error.")},c.onerror=function(){console.log("An error occurred while connection to the Schedjoules API.")},c.send()}},b.prototype.get_url=function(a){var b="";return"en"!=this.locale&&(b+="?locale="+this.locale),this.uri+a+b},b}(),c=function(){function b(a){var b={container:this.get_container(),on_update:this.render};this.configure(b,a)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.update=function(a){this.configure(a),this.trigger_event("sj-updated")},b.prototype.get_container=function(){var a=document.createElement("main");return a.setAttribute("role","main"),a},b.prototype.create_event=function(a){var b;return document.createEvent?(b=document.createEvent("HTMLEvents"),b.initEvent(a,!0,!0)):(b=document.createEventObject(),b.eventType=a),b.eventName=a,b},b.prototype.trigger_event=function(a){var b=this.create_event(a);document.createEvent?this.container.dispatchEvent(b):this.container.fireEvent("on"+b.eventType,b)},b}(),d=function(){function a(a){c.call(this,a)}return a.prototype=Object.create(c.prototype),a.prototype.constructor=a,a.prototype.init=function(){var a=this;return a.initialized||(a.container.addEventListener("sj-updated",function(){a.on_update(a)}),a.trigger_event("sj-updated"),a.initialized=!0),a},a.prototype.render=function(){this.container.innerHTML="";var a=document.createElement("h1");a.innerHTML=this.category+" - "+this.name,this.container.appendChild(a);var b=document.createElement("section");b.textContent=this.url;var c=document.createElement("a");return c.setAttribute("href",this.url),c.textContent="Download ICS file",b.appendChild(c),this.container.appendChild(b),this.container},a}(),e=function(){function a(a){c.call(this,a)}return a.prototype=Object.create(c.prototype),a.prototype.constructor=a,a.prototype.init=function(){var a=this;return a.initialized||(a.load(),a.container.addEventListener("sj-updated",function(){document.body.contains(a.container)&&a.on_update(a)}),a.initialized=!0),a},a.prototype.load=function(){var a=this,b="/pages/"+a.item_id;this.sdk.loader.load_data(b,function(b){a.sdk.cache_items(b),a.update(b),a.trigger_event("sj-loaded")})},a.prototype.render_item=function(a){var b=document.createElement("li"),c=document.createElement("a"),d=document.createElement("img");return c.setAttribute("href","#"),c.setAttribute("data-id",a.item.item_id),c.setAttribute("data-item-class",a.item_class),c.setAttribute("title",a.item.category+" - "+a.item.name),a.item.icon&&(d.setAttribute("src",a.item.icon),d.setAttribute("alt",a.item.category+" - "+a.item.name+" icon"),c.appendChild(d)),c.appendChild(document.createTextNode(a.item.name)),b.appendChild(c),b},a.prototype.render_section=function(a){var b=document.createElement("section"),c=document.createElement("h1"),d=document.createElement("ul");c.innerHTML=a.name,b.appendChild(c);for(var e=0;e<a.items.length;e++)d.appendChild(this.render_item(a.items[e]));return b.appendChild(d),b},a.prototype.render=function(a){this.container.innerHTML="";for(var b=0;b<this.page_sections.length;b++)a.container.appendChild(this.render_section(this.page_sections[b]));return a},a}(),f=function(){function b(a){var b={selected:"",options:[]};this.configure(b,a)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.load=function(a,b){var c=this;this.sdk.loader.load_data(a,function(a){c.set_options(a),b(c)})},b.prototype.render=function(){var a=document.createElement("select");for(var b in this.options){var c=document.createElement("option");c.setAttribute("value",this.options[b].value),c.innerHTML=this.options[b].text,this.options[b].value==this.selected&&c.setAttribute("selected",!0),a.appendChild(c)}return a},b}(),g=function(){function a(a){f.call(this,a)}return a.prototype=Object.create(f.prototype),a.prototype.constructor=a,a.prototype.set_options=function(a){for(var b in a)this.options.push({value:a[b].iso_639_1,text:a[b].name})},a.prototype.load=function(a){f.prototype.load.call(this,"/languages",a)},a.prototype.render=function(){var a=this,b=f.prototype.render.call(this);return b.addEventListener("change",function(b){a.update(b)}),b},a.prototype.update=function(a){var b=a.currentTarget,c=b.options[b.selectedIndex].value;this.selected=c,SJ.set_locale(c)},a}(),h=function(){function a(a){f.call(this,a)}return a.prototype=Object.create(f.prototype),a.prototype.constructor=a,a.prototype.set_options=function(a){for(var b in a)this.options.push({value:a[b].page_id,text:a[b].name_translation}),a[b].iso_3166==this.selected&&(this.selected=a[b].page_id)},a.prototype.load=function(a){f.prototype.load.call(this,"/countries",a)},a.prototype.render=function(){var a=f.prototype.render.call(this);return a.addEventListener("change",function(a){var b=a.currentTarget;this.selected=b.options[b.selectedIndex].value}),a},a}(),i=function(){function c(){var a="us",c="en",d={items:{},loader:new b({location:a,locale:c}),locales:new g({selected:c,sdk:this}),locations:new h({selected:a,sdk:this})};this.configure(d)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.set_api_key=function(a){this.loader.configure({api_key:a})},c.prototype.set_locale=function(a){this.loader.locale!=a&&(this.loader.locale=a,this.update_pages())},c.prototype.get_page=function(a,b){var c,d=this;return"undefined"!=typeof d.items[a]?c=d.items[a]:(c=new e({item_id:a,sdk:d}),d.items[a]=c),c.configure(b).init()},c.prototype.get_calendar=function(a,b){var c=this;return"undefined"!=typeof c.items[a]?c.items[a].configure(b).init():void 0},c.prototype.cache_items=function(a){var b=this;for(var c in a.page_sections){var f=a.page_sections[c].items;for(var g in f){var h=f[g].item;"undefined"!=typeof b.items[h.item_id]?b.items[h.item_id].update(h):(h.sdk=b,b.items[h.item_id]="page"==f[g].item_class?new e(h):new d(h))}}},c.prototype.update_pages=function(){for(var a in this.items)this.items.hasOwnProperty(a)&&this.items[a]instanceof e&&this.items[a].initialized&&this.items[a].load()},c}();return new i}();